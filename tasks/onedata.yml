---
- name: Copy galaxyctl_libs scripts
  template:
    src: '{{ item.script }}'
    dest: '{{ item.destination }}'
    mode: a+x
  with_items:
    - { script: 'galaxyctl_libs.py.j2', destination: '{{ galaxy_custom_script_path }}/galaxyctl_libs.py', mode: 'a+x' }
    - { script: 'onedatactl.py.j2', destination: '{{ galaxy_custom_script_path}}/onedatactl', mode: 'a+x' }
  become_user: root
  become_method: sudo

- name: Copy onedatactl.ini file
  template:
    src: 'onedatactl.ini.j2'
    dest: '{{ onedatactl_config_file }}'
  become_user: root
  become_method: sudo

- name: Configure onedatactl configuration file
  ini_file:
    dest: '{{ onedatactl_config_file }}'
    section: '{{ item.section }}'
    option: '{{ item.option }}'
    value: '{{ item.value }}'
  with_items:
    - { section: 'userdata', option: 'mountpoint', value: '{{ onedata_dir }}' }
    - { section: 'userdata', option: 'provider', value: '{{ userdata_provider }}' }
    - { section: 'userdata', option: 'token', value: '{{ userdata_token }}' }
  become_user: root
  become_method: sudo

- name: Mount Onedata Galaxy Data space
  shell: 'oneclient -H {{ userdata_provider }} -t {{ userdata_token }} {{ onedata_dir }} --insecure -o nonempty'

#- name: Create {{ tool_deps_path }} directory
#  file:
#    path: '{{ tool_deps_path }}'
#    state: directory
  #  owner: '{{ galaxy_user }}'
  #  group: '{{ galaxy_user }}'
  #become_user: root
  #become_method: sudo
